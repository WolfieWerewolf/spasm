<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Spasm Underrun</title>
    <style>body{margin:0px;background:black;}#root{display:flex;justify-content:center;align-items:center;}div:last-child{color:#e90;}b{animation:r 1s infinite;}@keyframes r{50%{opacity:0;}}#c{height:100vh;image-rendering:optimizeSpeed;image-rendering:pixelated;cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHAQMAAAD+nMWQAAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAF0Uk5TAEDm2GYAAAATSURBVAjXYxBgEGBgYDgGxEAWAAc4AQebSvKuAAAAAElFTkSuQmCC),auto;}code{font-weight:bold;color:#c80;position:absolute;top:4vw;left:2vw;font-size:1.6vw;overflow:hidden;white-space:nowrap;width:94%;text-shadow: 0 0 7px #f70;transition:opacity 1s;}.transparent code{opacity:0.0}.hide code{display:none;}</style></head>
    </head>
    <body>
        <div id="root"></div>
    <script type="text/javascript">!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"spasm",function(){return h}),r.d(n,"encoders",function(){return y}),r.d(n,"decoders",function(){return v}),r.d(n,"jsExports",function(){return w});var a={};r.r(a),r.d(a,"nodes",function(){return C}),r.d(a,"addPtr",function(){return A}),r.d(a,"jsExports",function(){return P});var o={};r.r(o),r.d(o,"jsExports",function(){return O});var s={};r.r(s),r.d(s,"jsExports",function(){return M});var i={};r.r(i),r.d(i,"jsExports",function(){return N});var l=arguments;const d=(e,t,r)=>{throw"ABORT: $what @ $file:$line"},u=new TextDecoder("utf-8"),c=new TextEncoder,g=new WebAssembly.Memory({initial:256,maximum:256});let m=2,f={1:document,2:window},p=g.buffer,_=e=>null===e||void 0==e?0:(f[++m]=e,m),b=e=>f[e];const h={memory:g,heapi32s:new Int32Array(p),heapi32u:new Uint32Array(p),heapi16s:new Int16Array(p),heapi16u:new Uint16Array(p),heapi8s:new Int8Array(p),heapi8u:new Uint8Array(p),heapf32:new Float32Array(p),heapf64:new Float64Array(p),instance:null,init:e=>{let t={env:Object.assign.apply(null,e.map(e=>e.jsExports).filter(e=>!!e))};WebAssembly.instantiateStreaming(fetch("underrun"),t).then(e=>{h.instance=e.instance,e.instance.exports._start()})},objects:f,addObject:_};let y={string:(e,t)=>{const r=c.encode(t),n=h.instance.exports.allocString(r.length),a=new Uint8Array(p,n,r.length);return h.heapi32u[e/4]=r.length,h.heapi32u[e/4+1]=n,a.set(r),e}},v={string:(e,t)=>(null==t&&(t=h.heapi32u[(e+4)/4],e=h.heapi32u[e/4]),u.decode(new DataView(p,t,e)))},w={_d_arraycast_len:()=>{console.log("_d_arraycast_len called")},onOutOfMemoryError:()=>d(),_d_assert:(e,t)=>d(),doLog:e=>console.log(e),memory:h.memory,__assert:()=>{},_Unwind_Resume:()=>{console.log(l)},_d_dynamic_cast:()=>{console.log(l)},spasm_add__bool:e=>_(!!e),spasm_add__int:_,spasm_add__uint:_,spasm_add__long:_,spasm_add__ulong:_,spasm_add__short:_,spasm_add__ushort:_,spasm_add__byte:_,spasm_add__ubyte:_,spasm_add__float:_,spasm_add__double:_,spasm_add__object:()=>_({}),spasm_add__string:(e,t)=>_(v.string(e,t)),spasm_get__field:(e,t,r)=>_(b(e)[v.string(t,r)]),spasm_get__int:b,spasm_get__uint:b,spasm_get__long:b,spasm_get__ulong:b,spasm_get__short:b,spasm_get__ushort:b,spasm_get__float:b,spasm_get__double:b,spasm_get__byte:b,spasm_get__ubyte:b,spasm_get__string:(e,t)=>{y.string(e,b(t))},spasm_removeObject:e=>{delete f[e]}},x=h;const C=x.objects,A=x.addObject;let S=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];let j=["click","change","input","keydown","keyup","dblclick","blur","mousemove","mouseup","mousedown","keypress"],E=null;const B=e=>{const t=e.currentTarget.wasmId,r=e.currentTarget.wasmEvents[e.type],n=r.cbs;E=e,n.forEach(e=>x.instance.exports.domEvent(t,e.ctx,e.fun,r.eventType)),E=null};let P={appendChild:(e,t)=>{C[e].appendChild(C[t])},insertBefore:(e,t,r)=>{C[e].insertBefore(C[t],C[r])},addCss:(e,t)=>{var r=document.createElement("style");r.type="text/css",r.innerHTML=v.string(e,t),document.getElementsByTagName("head")[0].appendChild(r)},addClass:(e,t,r)=>{C[e].classList.add(v.string(t,r))},removeClass:(e,t,r)=>{C[e].classList.remove(v.string(t,r))},changeClass:(e,t,r,n)=>{n?C[e].classList.add(v.string(t,r)):C[e].classList.remove(v.string(t,r))},unmount:e=>{var t=C[e];t.parentNode.removeChild(t)},removeChild:e=>{var t=C[e];t.parentNode.removeChild(t)},getRoot:()=>A(document.querySelector("#root")),createElement:e=>A(document.createElement((e=>S[e])(e))),focus:e=>{C[e].focus()},setSelectionRange:(e,t,r)=>{C[e].setSelectionRange(t,r)},innerText:(e,t,r)=>{C[e].innerText=v.string(t,r)},setAttribute:(e,t,r,n,a)=>{const o=v.string(t,r),s=v.string(n,a);C[e].setAttribute(o,s)},addEventListener:(e,t,r,n,a)=>{var o=j[t],s=C[e];if(void 0===s.wasmEvents)var i=s.wasmEvents={};else i=C[e].wasmEvents;i[o]&&i[o].cbs.length>0?i[o].cbs.push({ctx:r,fun:n}):(i[o]={cbs:[{ctx:r,fun:n}],eventType:a},s.addEventListener(o,B))},removeEventListener:(e,t,r,n,a)=>{var o=j[t];if(void 0!==C[e].wasmEvents){var s=C[e].wasmEvents;s[o]&&s[o].cbs.length>0&&(s[o].cbs=s[o].cbs.filter(e=>!(e.ctx==r&&e.fun==n)))}},getEventBool:(e,t)=>!!E[v.string(e,t)],getEventInt:(e,t)=>0+E[v.string(e,t)],getEventString:(e,t,r)=>y.string(e,E[v.string(t,r)]),setPropertyBool:(e,t,r,n)=>{const a=C[e],o=v.string(t,r);a&&void 0!==a[o]&&(a[o]=n)},setPropertyInt:(e,t,r,n)=>{P.setPropertyBool(e,t,r,n)},setProperty:(e,t,r,n,a)=>{const o=C[e],s=v.string(t,r);o&&void 0!==o[s]&&(o[s]=v.string(n,a))},getPropertyInt:(e,t,r)=>{const n=C[e],a=v.string(t,r);return!(!n||void 0===n[a])&&+n[a]},getPropertyBool:(e,t,r)=>{const n=C[e],a=v.string(t,r);return!(!n||void 0===n[a])&&!!n[a]},getProperty:(e,t,r,n)=>{const a=C[t],o=v.string(r,n);return a&&void 0!==a[o]?y.string(e,a[o]):y.string(e,"")}},T=h.objects,k=h.addObject,O={baseAudioContextDestination:function(e){var t=T[e].destination;return t.__handle||(t.__handle=k(t)),t.__handle},audioBufferSourceNodeLoopSet(e,t){T[e].loop=!!t},audioBufferSourceNodeConnect(e,t){T[e].connect(T[t])},audioBufferSourceNodeStart(e){T[e].start()},audioBufferSourceNodeBuffer(e,t){T[e].buffer=T[t]},windowNewAudioContext:function(){return k(new(window.webkitAudioContext||window.AudioContext))},baseAudioContextCreateBuffer:function(e,t,r,n){return k(T[e].createBuffer(t,r,n))},audioBufferGetChannelData:function(e,t){return k(T[e].getChannelData(t))},float32ArraySet:function(e,t,r){let n=new Float32Array(h.memory.buffer,r,t);T[e].set(n)},baseAudioContextCreateBufferSource:function(e){return k(T[e].createBufferSource())},audioFree:function(e){delete T[e]}};const L=h.addObject;let I,M={atan2:(e,t)=>Math.atan2(e,t),cos:e=>Math.cos(e),sin:e=>Math.sin(e),sqrt:e=>Math.sqrt(e),random:()=>Math.random(),pow:(e,t)=>Math.pow(e,t),ldexpf:(e,t)=>Math.pow(e,t),setTimeout:(e,t,r)=>setTimeout(()=>{h.instance.exports.jsCallback0(e,t)},r),clearTimeout(e){clearTimeout(e)},load_image(e,t,r,n){let a=new Image;a.src="images/"+v.string(e,t)+".png",a.onload=function(){let e=L(this);h.instance.exports.jsCallback(r,n,e)}},load_level(e,t,r,n,a){let o=new Image,s=new Uint8Array(h.memory.buffer,r,4096);o.src="images/l"+e+".png",o.onload=function(){var e=document.createElement("canvas");e.width=e.height=64,(e=e.getContext("2d")).drawImage(this,0,0),e=e.getImageData(0,0,64,64).data;for(var t=0,o=0;t<64;t++)for(var i=0;i<64;i++,o++){var l=(e[4*o]>>4<<8)+(e[4*o+1]>>4<<4)+(e[4*o+2]>>4);s[o]=2184===l?2:15===l?4:3840===l?5:240===l?3:0!==l?1:0}h.instance.exports.jsCallback(n,a,r)}},scheduleFrame(e,t){requestAnimationFrame(()=>{let r=parseInt(performance.now(),10);h.instance.exports.jsCallback(e,t,r)})}},D={},U=h.objects,F=h.addObject,N={getContext(e){let t=U[e];return D[e]=t.getContext("webgl")||t.getContext("experimental-webgl"),e},glSetContext(e){I=D[e]},glAttachShader(e,t){I.attachShader(U[e],U[t])},glBindBuffer(e,t){I.bindBuffer(e,U[t])},glBindTexture(e,t){I.bindTexture(e,U[t])},glBlendFunc(e,t){I.blendFunc(e,t)},glBufferData(e,t,r,n){let a=new Float32Array(h.memory.buffer,r,t);I.bufferData(e,a,n)},glClear(e){I.clear(e)},glClearColor(e,t,r,n){I.clearColor(e,t,r,n)},glCompileShader(e){I.compileShader(U[e])},glCreateProgram:()=>F(I.createProgram()),glCreateShader:e=>F(I.createShader(e)),glDrawArrays(e,t,r){I.drawArrays(e,t,r)},glEnable(e){I.enable(e)},glEnableVertexAttribArray(e){I.enableVertexAttribArray(e)},glCreateBuffer:()=>F(I.createBuffer()),glCreateTexture:()=>F(I.createTexture()),glGetAttribLocation:(e,t,r)=>I.getAttribLocation(U[e],v.string(t,r)),glGetShaderInfoLog(e){},glGetUniformLocation:(e,t,r)=>F(I.getUniformLocation(U[e],v.string(t,r))),glLinkProgram(e){I.linkProgram(U[e])},glShaderSource(e,t,r){I.shaderSource(U[e],v.string(t,r))},glTexImage2D(e,t,r,n,a,o){I.texImage2D(e,t,r,n,a,U[o])},glTexParameteri(e,t,r){I.texParameteri(e,t,r)},glUniform1fv(e,t,r){let n=new Float32Array(h.memory.buffer,r,t);I.uniform1fv(U[e],n)},glUniform3f(e,t,r,n){I.uniform3f(U[e],t,r,n)},glUseProgram(e){I.useProgram(U[e])},glVertexAttribPointer(e,t,r,n,a,o){I.vertexAttribPointer(e,t,r,n,a,o)},glViewport(e,t,r,n){I.viewport(e,t,r,n)}};const q=[n,a,o,s,i];n.spasm.init(q)}]);</script></body>
</html>
